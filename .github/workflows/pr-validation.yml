name: PR Validation
on:
  pull_request:
    types:
      - opened
      - synchronize
      - reopened
    branches: ['**']
  merge_group:
  push:
    branches: ['**']
  workflow_dispatch:

jobs:
  check_code_style:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 20
      - name: Install Dependencies
        run: npm install
      - name: Check Code Style
        run: npm run lint
      - name: Notify Slack
        if: always()
        uses: slackapi/slack-github-action@v1.25.0
        with:
          channel-id: ${{ secrets.SLACK_CHANNEL_ID }}
          slack-message: |
            :${{ job.status == 'success' && 'white_check_mark' || 'x' }}: Job *check_code_style* ${{ job.status }}
            Repository: ${{ github.repository }}
            Commit: ${{ github.sha }}
            URL: ${{ github.server_url }}/CSE210-FA25-Team04/text-emoji-converter/actions/runs/${{ github.run_id }}
        env:
          SLACK_BOT_TOKEN: ${{ secrets.SLACK_BOT_TOKEN }}

  check_pr_title:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 20
      - name: Install Dependencies
        run: npm install
      - name: Check PR Title
        run: |
          echo "${{ github.event.pull_request.title }}" > pr_title.txt
          npx commitlint --edit pr_title.txt --strict
          rm pr_title.txt
      - name: Notify Slack
        if: always()
        uses: slackapi/slack-github-action@v1.25.0
        with:
          channel-id: ${{ secrets.SLACK_CHANNEL_ID }}
          slack-message: |
            :${{ job.status == 'success' && 'white_check_mark' || 'x' }}: Job *check_pr_title* ${{ job.status }}
            Repository: ${{ github.repository }}
            Commit: ${{ github.sha }}
            URL: ${{ github.server_url }}/CSE210-FA25-Team04/text-emoji-converter/actions/runs/${{ github.run_id }}
        env:
          SLACK_BOT_TOKEN: ${{ secrets.SLACK_BOT_TOKEN }}
